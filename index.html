<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MindAR Local</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: black; }
    #debug-panel {
      position: absolute; top: 0; left: 0; width: 100%; padding: 10px;
      color: yellow; font-family: sans-serif; font-size: 14px;
      background: rgba(0,0,0,0.7); z-index: 9999; pointer-events: none;
    }
  </style>

  <!-- 1. لود کردن فایل‌های لوکال -->
  <script src="three.min.js"></script>
  <script src="mindar-image-three.prod.js"></script>
</head>

<body>
  <div id="debug-panel">سیستم در حال آماده‌سازی...</div>

  <script>
    const debugDiv = document.getElementById('debug-panel');
    function log(msg, color="yellow") {
      debugDiv.innerHTML = `<span style="color:${color}">${msg}</span>`;
      console.log(msg);
    }

    // چک کردن اینکه فایل‌ها درست دانلود شده‌اند
    if (!window.THREE) { 
        log("خطا: فایل three.min.js پیدا نشد. لطفا آن را دانلود کنید و کنار فایل html بگذارید.", "red");
    } 
    else if (!window.MINDAR) { 
        log("خطا: فایل mindar-image-three.prod.js پیدا نشد.", "red");
    } 
    else { 
        startApp(); 
    }

    async function startApp() {
      try {
        log("در حال تنظیم دوربین...");
        
        const mindarThree = new window.MINDAR.IMAGE.MindARThree({
          container: document.body,
          // 2. آدرس فایل تارگت لوکال
          imageTargetSrc: "card.mind", 
          uiLoading: "no", 
          uiScanning: "yes",
        });

        const { renderer, scene, camera } = mindarThree;

        // نورپردازی
        const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
        scene.add(light);

        // انکر (Anchor)
        const anchor = mindarThree.addAnchor(0);
        
        // ساخت مکعب
        const geometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
        const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
        const cube = new THREE.Mesh(geometry, material);
        cube.position.z = 0.1; // کمی جلوتر بیاید
        anchor.group.add(cube);

        log("لطفا صبر کنید...");
        
        await mindarThree.start();
        
        log("✅ دوربین روشن شد! کارت را نشان دهید.", "#00ff00");

        renderer.setAnimationLoop(() => {
          cube.rotation.x += 0.01;
          cube.rotation.y += 0.01;
          renderer.render(scene, camera);
        });

      } catch (err) {
        log("خطا: " + err.message, "red");
      }
    }
  </script>
</body>
</html>
